---
layout: post
title:  "[API]sns 로그인(카카오, 페이스북, 네이버)"
# date:   2019-05-13 18:34:10 +0700
date:   2020-03-06 00:00:00 +0700
categories: [api]
---

```html
<ul class="sns-login">
  <li><a id="login-btn-kakao" class="kakao-login" onclick="javascript:loginWithKakao();">카카오톡 계정으로 로그인</a></li>
</ul>
```

```javascript
  //백앤드로 보낼 전역 데이터
  let id = '';
  let nickName = '';
  let email = '';
```

```javascript
//카카오 로그인 함수
function loginWithKakao(){
	console.log("click event!");
	//<![CDATA[
    Kakao.init('5d2f5f6c1a49e1c83ec357b2dfe5c376'); // 사용할 앱의 JavaScript 키를 설정해 주세요.
    Kakao.Auth.login({
      success: function(authObj) {
        //alert(JSON.stringify(authObj));
        Kakao.API.request({
        	url : '/v2/user/me', //비동기식 경로가 v2로 업데이트됐다??
        	success : function(res){
        		//alert(JSON.stringify(res));
        		//console.log(res.id);
        		//console.log(res.properties['nickname']);
        		//console.log(res.kakao_account.email);

         		id = res.id;
        		nickName = res.properties['nickname'];
        		email = res.kakao_account.email;

        		//console.log('id' + id);
        		//console.log('nickName' + nickName);
        		//console.log('email' + email);

        		$.ajax({
        			type : 'POST',
        			url : '/signature/shop/page/snsLogin',
        			data : {
        				'id' : id,
        				'nickName' : nickName,
        				'email' : email
       				},
       				success : function(){
       					console.log('data처리 완료');
       					window.location.href="/signature/shop/page/index";
       				},
       				error : function(err){
       					console.log(err);
       				}
        		});
        	}
        });
      },
      fail: function(err) {
         alert(JSON.stringify(err));
      }
    });
  //]]>
}
```

```java
// Controller
// sns 로그인
@RequestMapping(value="/shop/page/snsLogin")
@ResponseBody //json형태로 받을수있음
public void snsLogin(@RequestParam Map<String, String> map,
           HttpSession session) {

  System.out.println("map = "+map);
  LoginDTO loginDTO = loginService.getUserBy(map);

  if(loginDTO == null) {
    System.out.println("데이터 없음");
    loginService.writeMember(map);
  } else {
    System.out.println("데이터 있음");
  }

  LoginDTO loginDTO1 = loginService.getUserBy(map);
  session.setAttribute("memId", loginDTO1.getId());
  session.setAttribute("memNickName", loginDTO1.getNickName());
  session.setAttribute("memEmail", loginDTO1.getEmail());

  System.out.println("session = " + session);
}
```

```java
//Mapper
<mapper namespace="loginSQL">
	<select id="getUserBy" parameterType="java.util.Map" resultType="member">
		select * from member where id = #{id}
	</select>

	<insert id="writeMember" parameterType="member">
		insert into member (id, nickName, email, logtime) values (#{id}, #{nickName}, #{email}, sysdate)
	</insert>
</mapper>
```
